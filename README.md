[logo]: https://raw.github.com/marcodebe/dicomecg_convert/master/images/logo.png
![ECG Dicom Convert][logo]

Dicom ECG Conversion
====================
Convert Dicom ECG (waveform) to PDF, PNG, etc.

Usage
-----
```bash
python convert.py <inputfile> [--layout=LAYOUT] [--output=FILE|--format=FMT]
python convert.py <stu> <ser> <obj> [--layout=LAYOUT] [--output=FILE|--format=FMT]
python convert.py --help
```
For example the file [anonymous\_ecg\_3X4\_1.png](https://github.com/marcodebe/dicomecg_convert/blob/master/sample_files/anonymous_ecg_3X4_1.png)
is generated by:
```
python convert.py sample_files/anonymous_ecg.dcm -o sample_files/anonymous_ecg_4X3_1.pdf
```

Input can be a file or the triplet studyUID, seriesUID, objectUID. In the latter
case dicom file is downloaded via [WADO](http://medical.nema.org/Dicom/2011/11_18pu.pdf).

The ouput format is deduced from the extension of the filename.

If output file is not given ```--format``` must be defined.

Supported output formats are: eps, jpeg, jpg, pdf, pgf, png, ps, raw, rgba, svg, svgz, tif, tiff.

The signals are filtered using a bandpass (0.05-40 Hz) butterworth filter of order 1.

```LAYOUT``` can be one of: 3X4\_1 (that is 3 rows for 4 colums plus 1 row), 3X4, 12X1 (default: 3X4_1)

New layouts can be defined adding the corresponding matrix in LAYOUT dictionary in ```config.py```.

The sample file is a 12-lead ECG anonymized  dicom file produced
by Mortara equipment and so are all the ECG files I have to test the program.

Install
-------

You have to install system libraries and a fortran compiler.
On Debian machine:

```bash
sudo apt-get install libblas-dev
sudo apt-get install liblapack-dev 
sudo apt-get install gfortran
```

You can install the corresponding packages from your distribution or in a virtualenv.

### Global
```bash
sudo pip install -r requirements.txt
git clone git@github.com:marcodebe/dicomecg_convert.git
cd dicomecg_convert
sudo python setup.py install
```

### Inside a virtualenv

```bash
git clone git@github.com:marcodebe/dicomecg_convert.git
cd dicomecg_convert
virtualenv .
. bin/activate
pip install -r requirements.txt
python setup.py install
```

Structure of DICOM Waveform
---------------------------
```
       Series
          |
 contains | (1,n)
          |
          |
          v
       Waveform         * Waveform Attributes
          |                 Time of Acquisition
 contains | (1,n)           Acquisition Context
          |                 Annotation
          |
          v
    Multiplex Group     * Multiplex Group Attributes
          |                 Number of Channels
 contains | (1,n)           Sampling Frequenciy
          |                 Timing
          |
          v
       Channel          * Channel Definition Attributes
          |                 Channel Source
          |                   Metric
          |                   Anatomic Location(s)
          |                   Function
 contains | (1,n)             Tecnique
          |                 Channel Sensitivity
          |                 Baseline
          |                 Skew
          |                 Filter Characteristics
          |
          v
        Sample

```
